#! /usr/bin/env bash

bindkey -e

bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down

bindkey "^[[H" beginning-of-line
bindkey "^[[F" end-of-line
bindkey "^[[3~" delete-char

bindkey "^[[1;3C" forward-word
bindkey "^[[1;3D" backward-word

_FIRST_PROMPT=1

precmd() {
    if [[ -n $_FIRST_PROMPT ]]; then
        unset _FIRST_PROMPT
        return
    fi
    # shellcheck disable=SC2296
    print -P "%F{252}${(l:COLUMNS::â”€:)}%f"
}

gitci() {
    local ci
    ci=$(git rev-parse --short HEAD 2>/dev/null)
    if [ -n "$ci" ]; then
        if [[ $ci =~ ^[0-9]+$ ]]; then
            echo "ðŸš¨ %F{red}%B$ci%b%f "
        fi
    fi
}

gitbr() {
    local br
    br=$(git rev-parse --abbrev-ref HEAD 2>/dev/null)
    if [ -n "$br" ]; then
        if [ "$br" = "HEAD" ]; then
            echo "ðŸ’¥ %F{red}%B$br%b%f"
        else
            echo "ðŸŒ¿ %F{yellow}$br%f"
        fi
    fi
}

awsp() {
    if [ -n "$AWS_PROFILE" ]; then
        echo " â›… %F{magenta}%B$AWS_PROFILE%b%f"
    else
        echo ""
    fi
}

export PROMPT="%F{8}%(1j.[%j] .)%F{cyan}%D{%Y-%m-%d} %D{%H:%M:%S}%f %F{blue}%1~%f %B%(?.%F{green}âœ“.%F{red}âœ—)%f%b "
export RPROMPT="\$(gitci)\$(gitbr)\$(awsp)"

if [ -f /opt/homebrew/bin/vivid ]; then
    LS_COLORS="$(vivid generate catppuccin-latte)"
    export LS_COLORS
fi

zstyle ':completion:*:*:*:commands' ignored-patterns '*.lima' 'just-lsp'
